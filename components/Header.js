import { useEffect, useRef } from 'react'
import Link from 'next/link'
import BLOG from '@/blog.config'
import { useLocale } from '@/lib/locale'

const NavBar = () => {
  const locale = useLocale()
  const links = [
    { id: 0, name: locale.NAV.INDEX, to: BLOG.path || '/', show: true },
    { id: 1, name: locale.NAV.ABOUT, to: '/about', show: BLOG.showAbout },
    { id: 2, name: locale.NAV.RSS, to: '/feed', show: true },
    { id: 3, name: locale.NAV.SEARCH, to: '/search', show: true }
  ]
  return (
    <div className="flex-shrink-0">
      <ul className="flex flex-row">
        {links.map(
          link =>
            link.show && (
              <li
                key={link.id}
                className="block ml-4 text-black dark:text-gray-50 nav"
              >
                <Link href={link.to}>
                  <a>{link.name}</a>
                </Link>
              </li>
            )
        )}
      </ul>
    </div>
  )
}

const Header = ({ navBarTitle, fullWidth }) => {
  const useSticky = !BLOG.autoCollapsedNavBar
  const navRef = useRef(null)
  const sentinalRef = useRef([])
  const handler = ([entry]) => {
    if (navRef && navRef.current && useSticky) {
      if (!entry.isIntersecting && entry !== undefined) {
        navRef.current.classList.add('sticky-nav-full')
      } else {
        navRef.current.classList.remove('sticky-nav-full')
      }
    } else {
      navRef.current.classList.add('remove-sticky')
    }
  }
  useEffect(() => {
    const obvserver = new window.IntersectionObserver(handler)
    obvserver.observe(sentinalRef.current)
    // Don't touch this, I have no idea how it works XD
    // return () => {
    //   if (sentinalRef.current) obvserver.unobserve(sentinalRef.current)
    // }
  }, [sentinalRef])
  return (
    <>
      <div className="observer-element h-4 md:h-12" ref={sentinalRef}></div>
      <div
        className={`sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 ${
          !fullWidth ? 'max-w-3xl px-4' : 'px-4 md:px-24'
        }`}
        id="sticky-nav"
        ref={navRef}
      >
        <div className="flex items-center">
          <Link href="/">
            <a>
              <div className="h-6">
                <svg
                  width="58"
                  height="24"
                  viewBox="0 0 58 24"
                  fill="#CC7A5B"
                  xmlns="http://www.w3.org/2000/svg"
                >
<path fillRule="evenodd" clipRule="evenodd" d="M25.0513 5.05759e-06C25.9265 0.00219091 26.6349 0.712362 26.6349 1.58765V1.71485C26.6362 1.9771 26.6363 2.23628 26.6353 2.49244C26.6948 12.5972 28.6397 17.1113 30.273 19.0872C31.0947 20.0813 31.8571 20.4598 32.3353 20.6119C32.5825 20.6905 32.7736 20.7147 32.8834 20.7218C32.9346 20.7251 32.9679 20.7247 32.9805 20.7243C33.1688 20.7062 33.3589 20.7218 33.5418 20.7706C33.5438 20.7711 33.5468 20.7717 33.5506 20.7725C33.5706 20.7767 33.614 20.7851 33.6774 20.7931C33.8051 20.8093 34.0061 20.8231 34.255 20.8021C34.7411 20.7611 35.4252 20.588 36.1422 19.9986C37.5909 18.8075 39.5801 15.5494 39.5805 6.80769C39.5805 6.80678 39.5805 6.80587 39.5805 6.80496L39.5805 6.79962C39.5805 6.79585 39.5805 6.7916 39.5805 6.78687L39.5806 6.77757C39.5807 6.76041 39.581 6.73835 39.5816 6.71171C39.5829 6.65846 39.5853 6.58665 39.5902 6.49888C39.5999 6.32385 39.6194 6.08248 39.6588 5.79621C39.7362 5.23195 39.8962 4.45159 40.2361 3.64903C40.576 2.84652 41.1222 1.96062 42.0047 1.27228C42.9098 0.566302 44.0734 0.143762 45.4949 0.143762H45.4966C46.8643 0.14525 47.9706 0.621685 48.8076 1.37025C49.6117 2.08935 50.1003 2.99691 50.4029 3.79676C50.7081 4.60364 50.8571 5.38812 50.9317 5.95572C50.9695 6.24358 50.9895 6.48582 51.0002 6.66058C51.0055 6.74819 51.0085 6.81948 51.0102 6.87178C51.0111 6.89795 51.0116 6.91943 51.0119 6.93587C51.0121 6.9441 51.0122 6.95107 51.0123 6.95676L51.0124 6.96431L51.0124 6.96868C51.0124 6.9693 51.0124 6.9699 49.4248 6.98253L51.0124 6.9699C51.0125 6.97473 51.0125 6.97957 51.0125 6.98441C51.0022 15.63 52.991 18.8436 54.4374 20.0176C55.1556 20.6007 55.844 20.7734 56.3363 20.8142C56.5878 20.835 56.7913 20.8212 56.9208 20.805C56.9851 20.7969 57.0293 20.7885 57.05 20.7842C57.0602 20.7821 57.0644 20.781 57.0621 20.7816C57.0609 20.7819 57.0581 20.7826 57.0535 20.7838L57.0454 20.786L57.0404 20.7873L57.0376 20.7881C57.0362 20.7885 57.0347 20.7889 57.4644 22.3173C57.8941 23.8457 57.8925 23.8461 57.891 23.8466L57.8876 23.8475L57.8804 23.8495C57.8753 23.8509 57.8697 23.8524 57.8635 23.854C57.857 23.8557 57.8499 23.8576 57.8421 23.8596C57.8354 23.8613 57.8281 23.8631 57.8204 23.865C57.7876 23.8731 57.7465 23.8826 57.6977 23.8927C57.6003 23.913 57.4714 23.9361 57.3153 23.9557C57.0041 23.9946 56.578 24.0204 56.0742 23.9786C55.0559 23.8943 53.7304 23.5335 52.4362 22.483C49.859 20.391 47.8287 15.9408 47.8372 6.99505C47.8371 6.99077 47.8369 6.98419 47.8366 6.97542C47.8358 6.95087 47.8341 6.90943 47.8307 6.85355C47.8239 6.74136 47.8103 6.57366 47.7835 6.36955C47.7287 5.95323 47.6242 5.42572 47.433 4.92035C47.2391 4.40795 46.9882 4.00299 46.6909 3.73711C46.4267 3.5008 46.0699 3.31985 45.494 3.31906C44.738 3.31923 44.272 3.53081 43.9576 3.77603C43.6205 4.03897 43.3573 4.42146 43.16 4.88734C42.9627 5.35317 42.8577 5.8412 42.8045 6.22822C42.7785 6.4176 42.7663 6.57261 42.7606 6.67504C42.7578 6.726 42.7566 6.76319 42.7561 6.78426C42.7559 6.79477 42.7558 6.8012 42.7558 6.80324L42.7558 6.80496C42.7558 15.8483 40.7275 20.3394 38.1587 22.4513C36.8669 23.5134 35.5422 23.8802 34.5216 23.9662C34.0172 24.0087 33.5905 23.9827 33.2787 23.9433C33.1719 23.9298 33.0778 23.9146 32.9977 23.8997C32.9064 23.9005 32.7994 23.8983 32.6784 23.8905C32.3405 23.8686 31.8923 23.803 31.373 23.6378C30.3182 23.3024 29.0388 22.5779 27.8256 21.1103C26.788 19.855 25.8177 18.0815 25.0566 15.5753C24.2825 18.1312 23.2879 19.9257 22.2213 21.185C20.992 22.6366 19.6964 23.3388 18.6319 23.6544C18.108 23.8097 17.6567 23.8666 17.3176 23.882C17.148 23.8897 17.0061 23.887 16.8964 23.8809C16.8923 23.8807 16.8883 23.8805 16.8843 23.8803C16.8803 23.8805 16.8763 23.8806 16.8722 23.8808C16.7625 23.886 16.6205 23.8875 16.451 23.8784C16.1119 23.8603 15.661 23.7998 15.1379 23.6404C14.0753 23.3168 12.7823 22.6059 11.555 21.1474C10.4979 19.8911 9.51081 18.1083 8.73936 15.5787C7.96541 18.1356 6.97112 19.9315 5.90505 21.1925C4.67636 22.6457 3.38157 23.3501 2.31759 23.6678C1.79395 23.8241 1.34279 23.882 1.00367 23.898C0.83415 23.906 0.692204 23.9036 0.582484 23.8978C0.527587 23.8949 0.480622 23.8911 0.442155 23.8874C0.422916 23.8855 0.405784 23.8836 0.390829 23.8818C0.383351 23.8809 0.376415 23.88 0.370029 23.8792L0.360864 23.878L0.356593 23.8774C0.354545 23.8771 0.352529 23.8768 0.573694 22.3047C0.794859 20.7325 0.792906 20.7322 0.790985 20.7319L0.787279 20.7314L0.78037 20.7305C0.775987 20.7299 0.772046 20.7295 0.76854 20.729C0.761529 20.7282 0.75625 20.7276 0.752646 20.7273C0.748755 20.7269 0.746714 20.7268 0.746714 20.7268C0.746714 20.7268 0.747914 20.7268 0.750492 20.727C0.761789 20.7276 0.797307 20.7289 0.853568 20.7263C0.966027 20.7209 1.15972 20.6997 1.40924 20.6252C1.89155 20.4812 2.65624 20.117 3.48024 19.1424C5.1246 17.1974 7.09431 12.7021 7.14266 2.52566C7.1411 2.23541 7.14104 1.94125 7.14253 1.64315C7.1469 0.767875 7.85884 0.0612498 8.73412 0.0634348C9.6094 0.0656199 10.3178 0.775791 10.3178 1.65108V1.71485C10.3192 1.98799 10.3192 2.25782 10.318 2.52436C10.3746 12.6536 12.3399 17.1485 13.9845 19.1029C14.811 20.085 15.5785 20.4554 16.063 20.6029C16.3134 20.6792 16.5077 20.7016 16.6204 20.7077C16.6744 20.7106 16.7093 20.7096 16.7221 20.7091C16.8386 20.6966 16.9561 20.6971 17.0724 20.7105C17.0852 20.7112 17.1201 20.7124 17.1739 20.7099C17.2864 20.7048 17.4799 20.684 17.7292 20.6101C18.211 20.4672 18.9749 20.105 19.7983 19.1329C21.4433 17.1906 23.4154 12.6931 23.4599 2.49488C23.4582 2.19402 23.4581 1.88899 23.4597 1.57972C23.464 0.704443 24.176 -0.0021808 25.0513 5.05759e-06ZM16.6864 20.7133L16.687 20.7132L16.6868 20.7133L16.6864 20.7133ZM33.5645 20.7768V20.7768L33.5633 20.7765Z"/>
                </svg>
              </div>
            </a>
          </Link>
          {navBarTitle
            ? (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {navBarTitle}
            </p>
              )
            : (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {BLOG.title},{' '}
              <span className="font-normal">{BLOG.description}</span>
            </p>
              )}
        </div>
        <NavBar />
      </div>
    </>
  )
}

export default Header
