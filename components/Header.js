import { useEffect, useRef } from 'react'
import Link from 'next/link'
import BLOG from '@/blog.config'
import { useLocale } from '@/lib/locale'

const NavBar = () => {
  const locale = useLocale()
  const links = [
    { id: 0, name: locale.NAV.INDEX, to: BLOG.path || '/', show: true },
    { id: 1, name: locale.NAV.ABOUT, to: '/about', show: BLOG.showAbout },
    { id: 2, name: locale.NAV.RSS, to: '/feed', show: true },
    { id: 3, name: locale.NAV.SEARCH, to: '/search', show: true }
  ]
  return (
    <div className="flex-shrink-0">
      <ul className="flex flex-row">
        {links.map(
          link =>
            link.show && (
              <li
                key={link.id}
                className="block ml-4 text-black dark:text-gray-50 nav"
              >
                <Link href={link.to}>
                  <a>{link.name}</a>
                </Link>
              </li>
            )
        )}
      </ul>
    </div>
  )
}

const Header = ({ navBarTitle, fullWidth }) => {
  const useSticky = !BLOG.autoCollapsedNavBar
  const navRef = useRef(null)
  const sentinalRef = useRef([])
  const handler = ([entry]) => {
    if (navRef && navRef.current && useSticky) {
      if (!entry.isIntersecting && entry !== undefined) {
        navRef.current.classList.add('sticky-nav-full')
      } else {
        navRef.current.classList.remove('sticky-nav-full')
      }
    } else {
      navRef.current.classList.add('remove-sticky')
    }
  }
  useEffect(() => {
    const obvserver = new window.IntersectionObserver(handler)
    obvserver.observe(sentinalRef.current)
    // Don't touch this, I have no idea how it works XD
    // return () => {
    //   if (sentinalRef.current) obvserver.unobserve(sentinalRef.current)
    // }
  }, [sentinalRef])
  return (
    <>
      <div className="observer-element h-4 md:h-12" ref={sentinalRef}></div>
      <div
        className={`sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 ${
          !fullWidth ? 'max-w-3xl px-4' : 'px-4 md:px-24'
        }`}
        id="sticky-nav"
        ref={navRef}
      >
        <div className="flex items-center">
          <Link href="/">
            <a>
              <div className="h-6">
                <svg
                  width="436"
                  height="182"
                  viewBox="0 0 436 182"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M187.01 3.82271e-05C193.626 0.0165597 198.98 5.38428 198.98 12V12.9614C198.99 14.9436 198.991 16.9026 198.983 18.8387C199.433 95.2141 214.133 129.333 226.478 144.268C232.689 151.781 238.451 154.642 242.066 155.792C243.934 156.386 245.379 156.569 246.209 156.623C246.596 156.648 246.847 156.645 246.942 156.642C248.366 156.505 249.803 156.623 251.185 156.992C251.2 156.995 251.222 157 251.251 157.006C251.403 157.038 251.731 157.101 252.21 157.162C253.175 157.284 254.694 157.388 256.575 157.23C260.249 156.92 265.42 155.611 270.84 151.156C281.79 142.154 296.824 117.528 296.827 51.4549C296.827 51.4481 296.827 51.4412 296.827 51.4343L296.827 51.3939C296.827 51.3654 296.827 51.3333 296.828 51.2976L296.828 51.2273C296.829 51.0976 296.831 50.9309 296.836 50.7295C296.845 50.327 296.864 49.7842 296.901 49.1208C296.974 47.7979 297.122 45.9735 297.419 43.8098C298.005 39.5449 299.213 33.6467 301.783 27.5806C304.351 21.515 308.48 14.8191 315.15 9.61632C321.992 4.28031 330.786 1.08661 341.53 1.08661H341.543C351.881 1.09785 360.243 4.69892 366.569 10.3568C372.647 15.7921 376.339 22.6517 378.627 28.6973C380.934 34.7959 382.06 40.7253 382.624 45.0155C382.91 47.1912 383.061 49.0221 383.141 50.343C383.182 51.0052 383.204 51.544 383.217 51.9394C383.224 52.1372 383.228 52.2995 383.23 52.4238C383.231 52.486 383.232 52.5387 383.233 52.5816L383.234 52.6387L383.234 52.6718C383.234 52.6764 383.234 52.6809 371.234 52.7764L383.234 52.6809C383.234 52.7175 383.234 52.7541 383.234 52.7907C383.157 118.137 398.189 142.427 409.121 151.3C414.55 155.707 419.753 157.013 423.474 157.321C425.375 157.478 426.913 157.374 427.892 157.251C428.378 157.191 428.712 157.127 428.868 157.094C428.945 157.078 428.977 157.07 428.959 157.075C428.951 157.077 428.929 157.082 428.895 157.091L428.833 157.108L428.795 157.118L428.774 157.124C428.763 157.127 428.752 157.13 432 168.682C435.248 180.234 435.236 180.238 435.224 180.241L435.199 180.248L435.145 180.263C435.106 180.273 435.064 180.285 435.017 180.297C434.968 180.31 434.914 180.324 434.855 180.339C434.804 180.352 434.749 180.366 434.691 180.38C434.443 180.441 434.133 180.513 433.764 180.59C433.028 180.743 432.053 180.918 430.873 181.065C428.521 181.36 425.301 181.554 421.493 181.239C413.796 180.602 403.778 177.875 393.995 169.934C374.516 154.122 359.171 120.486 359.234 52.8711C359.234 52.8387 359.232 52.789 359.23 52.7227C359.224 52.5371 359.211 52.2239 359.186 51.8016C359.134 50.9536 359.031 49.686 358.828 48.1433C358.415 44.9966 357.625 41.0095 356.179 37.1897C354.714 33.3168 352.818 30.256 350.57 28.2464C348.573 26.4603 345.877 25.0926 341.523 25.0866C335.81 25.0879 332.287 26.6871 329.911 28.5406C327.363 30.528 325.374 33.419 323.882 36.9403C322.391 40.4612 321.597 44.1498 321.196 47.0751C320.999 48.5065 320.907 49.6781 320.864 50.4523C320.842 50.8375 320.833 51.1186 320.83 51.2778C320.828 51.3573 320.828 51.4059 320.827 51.4213L320.827 51.4343C320.827 119.787 305.497 153.733 286.081 169.695C276.317 177.723 266.304 180.495 258.591 181.145C254.778 181.466 251.553 181.27 249.196 180.972C248.389 180.87 247.677 180.755 247.072 180.642C246.382 180.649 245.573 180.632 244.659 180.573C242.105 180.408 238.717 179.911 234.792 178.663C226.82 176.128 217.15 170.652 207.98 159.559C200.137 150.071 192.803 136.667 187.05 117.723C181.199 137.042 173.682 150.605 165.62 160.124C156.329 171.095 146.536 176.403 138.49 178.788C134.531 179.962 131.12 180.392 128.556 180.508C127.275 180.567 126.202 180.546 125.373 180.501C125.342 180.499 125.312 180.497 125.282 180.495C125.251 180.497 125.221 180.498 125.19 180.5C124.361 180.539 123.288 180.55 122.006 180.482C119.443 180.345 116.036 179.887 112.082 178.683C104.05 176.237 94.2771 170.863 85.0007 159.839C77.0106 150.344 69.55 136.869 63.7191 117.749C57.8693 137.075 50.3541 150.649 42.2964 160.18C33.0095 171.165 23.223 176.489 15.1811 178.89C11.2232 180.071 7.81316 180.508 5.25003 180.63C3.96871 180.69 2.89583 180.672 2.06653 180.628C1.6516 180.606 1.29662 180.578 1.00587 180.549C0.860455 180.535 0.730965 180.521 0.61793 180.507C0.561407 180.5 0.508981 180.494 0.460718 180.487L0.391445 180.478L0.359159 180.474C0.343684 180.472 0.328448 180.469 2.00009 168.586C3.67173 156.703 3.65697 156.701 3.64245 156.699L3.61444 156.696L3.56222 156.689C3.52909 156.684 3.4993 156.681 3.4728 156.677C3.41981 156.671 3.37991 156.667 3.35267 156.664C3.32326 156.661 3.30784 156.66 3.30784 156.66C3.30784 156.66 3.31691 156.661 3.33639 156.662C3.42178 156.666 3.69024 156.677 4.11547 156.656C4.96548 156.616 6.42951 156.456 8.31541 155.893C11.9609 154.804 17.7407 152.051 23.9688 144.685C36.3975 129.984 51.2852 96.0068 51.6507 19.0899C51.6389 16.896 51.6384 14.6727 51.6497 12.4195C51.6827 5.80387 57.0638 0.462948 63.6795 0.479463C70.2952 0.495978 75.6495 5.8637 75.6495 12.4794V12.9614C75.6598 15.0259 75.6602 17.0654 75.651 19.08C76.079 95.6402 90.9335 129.615 103.364 144.387C109.611 151.81 115.412 154.609 119.074 155.724C120.967 156.3 122.435 156.47 123.287 156.516C123.695 156.538 123.959 156.531 124.056 156.527C124.936 156.433 125.824 156.436 126.703 156.537C126.8 156.542 127.063 156.551 127.471 156.533C128.32 156.495 129.784 156.337 131.668 155.778C135.309 154.699 141.083 151.961 147.306 144.613C159.74 129.932 174.646 95.9392 174.982 18.8572C174.969 16.5832 174.969 14.2777 174.98 11.9401C175.013 5.32443 180.395 -0.0164832 187.01 3.82271e-05ZM123.786 156.559L123.79 156.558L123.789 156.558L123.786 156.559ZM251.356 157.039V157.039L251.347 157.036Z" fill="black dark:white"/>
                </svg>
              </div>
            </a>
          </Link>
          {navBarTitle
            ? (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {navBarTitle}
            </p>
              )
            : (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {BLOG.title},{' '}
              <span className="font-normal">{BLOG.description}</span>
            </p>
              )}
        </div>
        <NavBar />
      </div>
    </>
  )
}

export default Header
